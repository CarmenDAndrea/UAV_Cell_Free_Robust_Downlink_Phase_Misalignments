% This function computes the orthogonal space-time block coding (OSTBC) matrices
% for a MIMO system. OSTBC matrices are deterministic matrices used to perform
% space-time block transmissions, aiming to improve diversity by transmitting
% symbols redundantly over time and space.
% Author: Marx Freitas

% INPUT
% N_period = Number of symbol periods per code matrix (bloc)
% s  = DIM: 1 x Nt - symbols to be transmitted at time block "t" (denoted
%       as block "k" in some references)

% OUTPUT
% X   = DIM: Nt x N_period - the "code matrix" to be transmitted.

% Observations
% "N_period" represents the number of times that a symbol "s" was
% transmitted over the time, i.e., it is transmitted in N epochs
% "N_period" is also called "Number of time intervals"

% Please, note that "N" does not represent the time of a symbol, but the
% time of a block (code matrix), which contains many symbols

function [An, Bn] = amicable_OSTBC_matrices (N_period, n_s)

An = zeros(N_period, N_period, n_s);
Bn = zeros(N_period, N_period, n_s);

switch N_period

    % Derived from appendix
    % Rules to see how An and Bn generates OSTBC X:
    % {Aij, Bij} corresponds to:
    % { 1  1} corresponds   sn
    % {-1  1} corresponds -conj(sn)
    % { 1 -1} corresponds  conj(sn)
    % {-1 -1} corresponds - sn

    case 2
        
        % For symbol 1
        An(:, :, 1) = [1, 0;...
                       0,-1];

        Bn(:, :, 1) = [1, 0;
                       0, 1];
        
        % For symbol 2
        An(:, :, 2) = [0, 1;...
                       1, 0];
        
        Bn(:, :, 2) = [0,-1;...
                       1, 0];


    case 4
        
        % For symbol 1
        An(:, :, 1) = [1, 0, 0, 0;...
                       0, 1, 0, 0;...
                       0, 0, 1, 0;...
                       0, 0, 0, 1];

        Bn(:, :, 1) = [1, 0, 0, 0;...
                       0, 1, 0, 0;...
                       0, 0,-1, 0;...
                       0, 0, 0,-1];
        
        % For symbol 2
        An(:, :, 2) = [0, 0, 1, 0;...
                       0, 0, 0, 1;...
                      -1, 0, 0, 0;...
                       0,-1, 0, 0];
        
        Bn(:, :, 2) = [0, 0, 1, 0;...
                       0, 0, 0,-1;...
                       1, 0, 0, 0;...
                       0,-1, 0, 0];

        % For symbol 3
        An(:, :, 3) = [0, 0, 0,-1;...
                       0, 0, 1, 0;...
                       0,-1, 0, 0;...
                       1, 0, 0, 0];

        Bn(:, :, 3) = [0, 0, 0,-1;...
                       0, 0,-1, 0;...
                       0,-1, 0, 0;...
                      -1, 0, 0, 0];


    case 8
        % For symbol 1
        An(:, :, 1) = [1, 0, 0, 0, 0, 0, 0, 0;
                       0, 1, 0, 0, 0, 0, 0, 0;...
                       0, 0, 1, 0, 0, 0, 0, 0;...
                       0, 0, 0, 1, 0, 0, 0, 0;...
                       0, 0, 0, 0, 1, 0, 0, 0;...
                       0, 0, 0, 0, 0, 1, 0, 0;...
                       0, 0, 0, 0, 0, 0, 1, 0;...
                       0, 0, 0, 0, 0, 0, 0, 1];


        Bn(:, :, 1) = [1, 0, 0, 0, 0, 0, 0, 0;
                       0, 1, 0, 0, 0, 0, 0, 0;...
                       0, 0, 1, 0, 0, 0, 0, 0;...
                       0, 0, 0, 1, 0, 0, 0, 0;...
                       0, 0, 0, 0,-1, 0, 0, 0;...
                       0, 0, 0, 0, 0,-1, 0, 0;...
                       0, 0, 0, 0, 0, 0,-1, 0;...
                       0, 0, 0, 0, 0, 0, 0,-1];
        
        % For symbol 2
        An(:, :, 2) = [0, 0, 0, 0, 0, 0, 1, 0;
                       0, 0, 0, 0, 0, 0, 0, 1;...
                       0, 0, 0, 0,-1, 0, 0, 0;...
                       0, 0, 0, 0, 0,-1, 0, 0;...
                       0, 0, 1, 0, 0, 0, 0, 0;...
                       0, 0, 0, 1, 0, 0, 0, 0;...
                      -1, 0, 0, 0, 0, 0, 0, 0;...
                       0,-1, 0, 0, 0, 0, 0, 0];


        Bn(:, :, 2) = [0, 0, 0, 0, 0, 0, 1, 0;
                       0, 0, 0, 0, 0, 0, 0,-1;...
                       0, 0, 0, 0, 1, 0, 0, 0;...
                       0, 0, 0, 0, 0,-1, 0, 0;...
                       0, 0, 1, 0, 0, 0, 0, 0;...
                       0, 0, 0,-1, 0, 0, 0, 0;...
                       1, 0, 0, 0, 0, 0, 0, 0;...
                       0,-1, 0, 0, 0, 0, 0, 0];

        % For symbol 3
        An(:, :, 3) = [0, 0, 0, 0, 0, 0, 0,-1;
                       0, 0, 0, 0, 0, 0, 1, 0;...
                       0, 0, 0, 0, 0,-1, 0, 0;...
                       0, 0, 0, 0, 1, 0, 0, 0;...
                       0, 0, 0,-1, 0, 0, 0, 0;...
                       0, 0, 1, 0, 0, 0, 0, 0;...
                       0,-1, 0, 0, 0, 0, 0, 0;...
                       1, 0, 0, 0, 0, 0, 0, 0];


        Bn(:, :, 3) = [0, 0, 0, 0, 0, 0, 0,-1;
                       0, 0, 0, 0, 0, 0,-1, 0;...
                       0, 0, 0, 0, 0,-1, 0, 0;...
                       0, 0, 0, 0,-1, 0, 0, 0;...
                       0, 0, 0,-1, 0, 0, 0, 0;...
                       0, 0,-1, 0, 0, 0, 0, 0;...
                       0,-1, 0, 0, 0, 0, 0, 0;...
                      -1, 0, 0, 0, 0, 0, 0, 0];


        % For symbol 4
        An(:, :, 4) = [0, 0, 0, 0, 1, 0, 0, 0;
                       0, 0, 0, 0, 0, 1, 0, 0;...
                       0, 0, 0, 0, 0, 0, 1, 0;...
                       0, 0, 0, 0, 0, 0, 0, 1;...
                      -1, 0, 0, 0, 0, 0, 0, 0;...
                       0,-1, 0, 0, 0, 0, 0, 0;...
                       0, 0,-1, 0, 0, 0, 0, 0;...
                       0, 0, 0,-1, 0, 0, 0, 0];


        Bn(:, :, 4) = [0, 0, 0, 0, 1, 0, 0, 0;
                       0, 0, 0, 0, 0, 1, 0, 0;...
                       0, 0, 0, 0, 0, 0,-1, 0;...
                       0, 0, 0, 0, 0, 0, 0,-1;...
                       1, 0, 0, 0, 0, 0, 0, 0;...
                       0, 1, 0, 0, 0, 0, 0, 0;...
                       0, 0,-1, 0, 0, 0, 0, 0;...
                       0, 0, 0,-1, 0, 0, 0, 0];


end